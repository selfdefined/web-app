{% extends 'layouts/base.njk' %}
{% set titleWithPath = 'Home Â« ' %}

{% block content %}
  <main>
    {{ content | safe }}
    {% include 'components/table-of-content.njk' %}

  </main>

{% endblock %}


{% block pageScript%}
<script>
  // don't use es6+ here because it will not be transpiled
  window.addEventListener('DOMContentLoaded', function() {
    if (location.hash) {
      var allLinks = Array.from(document.querySelectorAll('.toc__list-item > a'));

      for (var i = 0; i < allLinks.length; i++) {
        var link = allLinks[i]

        if (link.href.includes(location.hash.replace('#', ''))) {
          window.location = link.href
        }
      }
    }

    initSpoilers()
  })

  {#
    Simple spoiler components.
    Usage example (html):

    <button
      aria-expanded="true"
      aria-controls="element-with-large-content"
      class="spoiler__toggle-btn"
      id="toggle-spoiler-button">
    </button>
    <p
      class="spoiler__content"
      id="element-with-large-content"
      aria-labelledby="toggle-spoiler-button">
      A lot of content...
    </p>
  #}
  function initSpoilers() {
    const spoilerElements = document.querySelectorAll('.spoiler')

    if (spoilerElements.length === 0) {
      return;
    }

    for (let spoilerElem of spoilerElements) {
      if (spoilerElem.dataset.spoilerMobileOnly === 'true' && window.innerWidth > 880) {
        continue;
      }

      const toggleElem = spoilerElem.querySelector('.spoiler__toggle-btn')
      const contentElem = spoilerElem.querySelector('.spoiler__content')

      if (toggleElem != null && contentElem != null) {
        toggleElem.addEventListener('click', function handleSpoilerToggleClick() {
          spoilerElem.classList.toggle('spoiler_collapsed');

          const collapsed = spoilerElem.classList.contains('spoiler_collapsed');
          toggleElem.setAttribute('aria-expanded', String(!collapsed));
        })
      }
    }
  }

</script>
{% endblock %}
